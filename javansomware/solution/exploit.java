import java.io.File;
import java.nio.file.*;
import java.util.stream.Collectors;
import javax.crypto.*;
import javax.crypto.spec.SecretKeySpec;

public class Ransom {

    private static final String ALGORITHM_NAME = "RC4";
    private static final SecretKey SECRET_KEY = new SecretKeySpec("Long passphrase are always secure :)".getBytes(), ALGORITHM_NAME);

    public static void main(String[] args) throws Exception {
        var cipher = Cipher.getInstance(ALGORITHM_NAME);

        try (var stream = Files.walk(Paths.get("."))) {
            var files = stream.filter((file) -> Files.isRegularFile(file) && file.toString().endsWith(".hax"))
                .collect(Collectors.toList());

            for(Path p : files) {
                var data = Files.readAllBytes(p);
                var decrypted = decrypt(data, cipher);

                Files.write(new File(p.toString() + ".decoded").toPath(), decrypted);
            }
        }
    }

    private static byte[] decrypt(byte[] securelyEncrypted, Cipher cipher) throws Exception {
        var encrypted = new byte[securelyEncrypted.length];
        for(var i = 0; i < securelyEncrypted.length; ++i) {
            encrypted[i] = securelyEncrypted[securelyEncrypted.length - i - 1];
        }

        cipher.init(Cipher.DECRYPT_MODE, SECRET_KEY);
        var decrypted = cipher.doFinal(encrypted);

        return decrypted;
    }
}
